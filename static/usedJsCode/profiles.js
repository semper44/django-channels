let envURL="https://django-channels-byf5.onrender.com",trash=document.querySelectorAll(".profiletrash");trash.forEach(e=>{e.addEventListener("click",async t=>{let n=e.children[0].getAttribute("data-postdeleteid"),o=t.target.parentElement.getAttribute("data-postdeleteid");if(n===o){let r=await fetch(`${envURL}/delete_user_post/${n}/`,{method:"POST",headers:{"X-CSRFToken":csrfToken2}}),i=await r.json();if(r.ok&&"true"===i.success){let s=document.querySelector("#len_posts");if(s.innerHTML=+s.innerHTML-1,e.parentElement.parentElement.parentElement.childElementCount<2){let a=document.createElement("p");a.innerHTML="No feeds to fetch",a.classList.add("h-screen","w-full","bg-base-lightbg","dark:bg-base-darkbg","text-[#0d2438]","dark:text-white","text-center");let c=document.querySelector("#postcontent");c.append(a)}e.parentElement.parentElement.style.display="none",Toastify({text:"Delete succesfull ",duration:3e3,newWindow:!0,gravity:"top",position:"right",stopOnFocus:!0,style:{background:"linear-gradient(to right, #00b09b, #96c93d)"}}).showToast()}else Toastify({text:"An error ocured, please try again later ",duration:3e3,newWindow:!0,close:!0,gravity:"top",position:"right",stopOnFocus:!0,style:{background:"linear-gradient(to right, #00b09b, #96c93d)"}}).showToast()}})});let profileunfriendmodal=document.querySelector("#profileunfriendmodal"),profileclosemodal=document.querySelector("#profileclosemodal"),profileconfirmunfriend=document.querySelector("#profileconfirmunfriend"),unfriendButton=document.querySelector("#unfriendButton"),dataparent=document.querySelector(".dataparent"),friendName;const profilePictureInput=document.getElementById("profilePictureInput"),cameraIconLabel=document.getElementById("cameraIconLabel"),cameraIcon=document.getElementById("cameraIcon"),imagePreview=document.getElementById("imagePreview"),previewImage=document.getElementById("previewImage"),profilesubmitButton=document.getElementById("submitButton"),profileCancelButton=document.getElementById("cancelButton");function showContent(e){let t=document.getElementsByClassName("content"),n=document.querySelectorAll(".active"),o=document.querySelector("#postcontent");for(let r=0;r<t.length;r++){let i=t[r],s=i.getAttribute("data-content");s===e?"findfriends"===s||"friendrequest"===s||"groups"===s||"about"===s||"friends"===s?(i.style.width="100%",i.style.height="100%",i.style.display="grid",i.style.justifyContent="center",o.style.display="none"):"post"===s&&(i.style.display="block",o.style.display="flex",o.style.flexDirection="column"):i.style.display="none"}for(let a=0;a<n.length;a++){let c=n[a],l=c.getAttribute("data-content");l===e&&"search"!==l?"search"!==l&&(c.style.paddingBottom="10px",c.style.borderBottom="4px solid #0d2438"):"search"!==l&&(c.style.borderBottom="0 solid transparent")}}profilePictureInput&&profilePictureInput.addEventListener("change",function(){let e=profilePictureInput.files[0];if(e){let t=new FileReader;t.onload=function(e){previewImage.src=e.target.result,imagePreview.style.display="block",profilesubmitButton.style.display="block",profileCancelButton.style.display="block"},t.readAsDataURL(e)}profilesubmitButton&&(profilesubmitButton.onclick=async t=>{let n=new FormData(document.querySelector("#postform"));n.append("prof_pics",e);let o=await fetch(`${envURL}/change_profile_picture`,{method:"POST",body:n,headers:{"X-CSRFToken":"{{ csrf_token }}"}});o.ok?(window.location.reload(),Toastify({text:"Successful",duration:3e3,newWindow:!0,gravity:"top",position:"right",stopOnFocus:!0,style:{background:"linear-gradient(to right, #00b09b, #96c93d)"}}).showToast()):Toastify({text:"Something went wrong, try again later",duration:3e3,newWindow:!0,close:!0,gravity:"top",position:"right",stopOnFocus:!0,style:{background:"linear-gradient(to right, #00b09b, #96c93d)"}}).showToast()}),profileCancelButton&&(profileCancelButton.onclick=function(e){profilePictureInput.value="",imagePreview.style.display="none",profilesubmitButton.style.display="none",profileCancelButton.style.display="none"})}),unfriendButton&&unfriendButton.addEventListener("click",e=>{profileunfriendmodal.style.display="block",friendName=e.target.getAttribute("data-content")}),profileclosemodal.addEventListener("click",()=>profileunfriendmodal.style.display="none"),profileconfirmunfriend.addEventListener("click",e=>{getCookie("csrftoken");let t=new XMLHttpRequest;t.open("POST",`${envURL}/removefriends/${friendName}/`,!0),t.setRequestHeader("Content-Type","application/json"),t.setRequestHeader("X-CSRFToken",csrfToken),t.onreadystatechange=function(){t.readyState===XMLHttpRequest.DONE&&200===t.status&&(profileunfriendmodal.style.display="none")},t.send()});let profile_message2=document.querySelector("#profile_message");$(document).ready(function(){$("#friendrequestcontainer").click(function(){localStorage.getItem("mode"),$(".friendrequestparent").empty(),$.ajax({url:`${envURL}/received_request`,type:"GET",dataType:"json",success:function(e){if(e.received_request.length<1){let t=$("<p>").text("No friend request yet");$(".friendrequestparent").hide(),$("#loadingsequence").hide(),t.appendTo(".friendrequestparent2")}else $(".friendrequestparent2").hide(),$("#loadingsequence").hide(),$(".friendrequestparent").show(),e.received_request.forEach(function(e){let t,n=$("<div>");n.attr("id","frienddivbg");let o=$("<div>"),r=$("<div>");localStorage.getItem("mode"),n.css({width:"fit-content",height:"fit-content",padding:"1rem",display:"grid",gap:"5px","justify-item":"center","align-content":"center","background-color":`${t?"#1D2833":"white"} `,"border-radius":"10px","box-shadow":"0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04)",cursor:"pointer","transform-origin":"center","transition-property":"transform","transition-duration":"300ms"}),n.hover(function(){$(this).css({"box-shadow":"var(--box-shadow-xl)",transform:"scale(1.05)"})},function(){$(this).css({"box-shadow":"var(--box-shadow-lg)",transform:"scale(1)"})});let i=$("<p>").text(e.name);i.css({"font-size":"bold"});let s=$("<p>").text("Accept request");s.css({width:"fit",height:"fit",padding:"6","border-radius":"5px","background-color":"rgb(22 163 74)",color:"rgb(209 213 219)",cursor:"pointer"});let a=$("<p>").text("Decline request");a.css({width:"fit",height:"fit",padding:"6","border-radius":"5px","background-color":"rgb(22 163 74)",color:"rgb(209 213 219)",cursor:"pointer"});let c=$("<p>").text(e.bio),l=$("<img>");l.attr("src",e.pics),l.attr("alt","Profile Picture"),l.attr("width","80"),l.attr("height","80"),l.css("border-radius","50%");let d=$("<div>");o.css({display:"grid",gap:"5px","align-content":"center"}),r.css({display:"flex",gap:"5px","align-item":"center"}),d.css({display:"flex",gap:"5px","padding-right":"1rem","padding-top":"1rem"}),o.append(i),o.append(c),d.append(s),d.append(a),r.append(l),r.append(o),n.append(r),n.append(d),s.click(function(){let t=getCookie("csrftoken");$.ajax({url:`${envURL}/acceptfriendrequests/${e.relId}/`,type:"POST",dataType:"json",beforeSend:function(e,n){e.setRequestHeader("X-CSRFToken",t)},success:function(e){"ok"==e.success&&(d.empty(),d.text("Accepted"),d.css("text-align","center"))}})}),a.click(function(){let t=getCookie("csrftoken");$.ajax({url:`${envURL}/declinefriendrequest/${e.sender}/`,type:"POST",dataType:"json",beforeSend:function(e,n){e.setRequestHeader("X-CSRFToken",t)},success:function(e){"ok"===e.success?(d.empty(),d.text("Request declined"),Toastify({text:"Request declined",duration:3e3,newWindow:!0,gravity:"top",position:"right",stopOnFocus:!0,style:{background:"linear-gradient(to right, #00b09b, #96c93d)"}}).showToast()):Toastify({text:"Error! please try again later",duration:3e3,newWindow:!0,close:!0,gravity:"top",position:"right",stopOnFocus:!0,style:{background:"linear-gradient(to right, #00b09b, #96c93d)"}}).showToast()}})}),n.appendTo(".friendrequestparent")})},error:function(e){}})}),$("#searchButton").click(function(){let e=$("#searchButton").val();$.ajax({url:`${envURL}/search`,type:"GET",data:{query:e},dataType:"json",success:function(e){},error:function(){}})})}),profile_message2&&($("profileaddfriend").click(function(){let e=profile_message2.getAttribute("receiver");$.ajax({url:`${envURL}/addfriends/${e}/`,type:"POST",dataType:"json",beforeSend:function(e,t){e.setRequestHeader("X-CSRFToken",csrftoken)},success:function(e){"ok"==e.success&&($("profileaddfriend").text="Added")}})}),$("profileblock").click(function(){$.ajax({url:`${envURL}/blockuser/${friendusername}/`,type:"POST",dataType:"json",beforeSend:function(e,t){e.setRequestHeader("X-CSRFToken",csrftoken)},success:function(e){"ok"==e.success&&($("profileblock").text="Blocked")}})}));const groupsElement=document.querySelector("#groups"),dropdownContent=document.querySelector("#dropdown-content"),createContent=document.querySelector("#create-content"),groupcancelprofile=document.querySelector("#groupcancelprofile");function getCookie(e){let t=null;if(document.cookie&&""!==document.cookie){let n=document.cookie.split(";");for(let o=0;o<n.length;o++){let r=n[o].trim();if(r.substring(0,e.length+1)===e+"="){t=decodeURIComponent(r.substring(e.length+1));break}}}return t}function postComment(e){let t=$("#commentmessage").val(),n=new FormData;n.append("csrfmiddlewaretoken","{{ csrf_token }}"),n.append("comments",t),$("#comment_pics")[0]&&n.append("comment_pics",$("#comment_pics")[0].files[0]),$.ajax({method:"POST",url:e,data:n,processData:!1,contentType:!1,success:function(e){},error:function(e){}})}function postReply(e,t){let n=$(this),o=n.attr("data-content"),r=$(".replyform[data-content='"+o+"']");r.length>0&&r.toggle(),$("#replyinput").on("click",function(){let e=$("#replymessage").val();r.data("content");let n=new FormData;n.append("csrfmiddlewaretoken","{{ csrf_token }}"),n.append("reply_text",e),$("#reply_pics")[0]&&n.append("reply_pics",$("#reply_pics")[0].files[0]),$.ajax({method:"POST",url:t,data:n,processData:!1,contentType:!1,success:function(e){},error:function(e){}})})}createContent&&(createContent.onclick=function(){creategroupmodal.style.display="block"}),groupcancelprofile&&(groupcancelprofile.onclick=function(e){e.preventDefault(),creategroupmodal.style.display="none"}),$("#allgroups").on("click",function(){$(".groupsparent").empty(),$.ajax({method:"GET",url:`${envURL}/allgroups/json/`,processData:!1,contentType:!1,success:function(e){if(e.length<1){let t=$("<p>").text("No groups found");t.addClass("h-screen w-full bg-base-lightbg dark:bg-base-darkbg text-[#0d2438] dark:text-white text-center"),$(".groupsparent").append(t)}else JSON.parse(e).forEach(e=>{let t=$("<div>"),n=$("<div>"),o=$("<div>");o.css({display:"grid",gap:"5px","justify-items":"center"}),n.css({display:"flex",gap:"5px","justify-content":"center"}),t.css({width:"fit-content",height:"fit-content","padding-top":"1rem","padding-bottom":"1rem","padding-left":"1rem","padding-right":"1rem",display:"grid",gap:"5px","justify-items":"center","align-content":"center","box-shadow":"0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04)","border-radius":"10px","margin-top":"1rem","margin-bottom":"1rem","margin-left":"1rem","margin-right":"1rem",cursor:"pointer","transform-origin":"center","transition-property":"transform","transition-duration":"300ms"}),t.hover(function(){$(this).css({"box-shadow":"var(--box-shadow-xl)",transform:"scale(1.05)"})},function(){$(this).css({"box-shadow":"var(--box-shadow-lg)",transform:"scale(1)"})});let r=$("<p>").text(e.fields.name),i=$("<p>").text(e.fields.description),s=$("#prof_pics").data("content");r.css({"font-size":"bold"}),i.css({opacity:"0.6","margin-bottom":"1rem"});let a=$("<img>");a.attr("src",e.fields.cover_photo),a.attr("alt","cover photo"),a.attr("width","80"),a.attr("height","80"),a.css("border-radius","50%");let c;s===e.fields.owner?(c=$("<p>").text("Your group")).css("color","lime"):((c=$("<p>").text("join group")).css({width:"80%",height:"fit",padding:"6","border-radius":"5px","background-color":"rgb(22 163 74)",color:"rgb(209 213 219)",cursor:"pointer","text-align":"center"}),c.click(function(){let t=getCookie("csrftoken");$.ajax({url:`${envURL}/join-group/${e.pk}`,type:"POST",dataType:"json",beforeSend:function(e,n){e.setRequestHeader("X-CSRFToken",t)},success:function(e){}})})),o.append(r),o.append(i),n.append(a),n.append(o),t.append(n),t.append(c),t.appendTo(".groupsparent"),t.click(function(){window.location.href=`${envURL}/group-view/${e.fields.name}`})})},error:function(e){console.log(e)}})});