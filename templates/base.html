{% load static %}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    
    {% block title %}        
    {% endblock title %}
        
    <script src="{% static 'js/alpine.js' %}"></script>
    <script src="{% static 'js/toastify.js' %}"></script>
    <script src="{% static 'jquery/jquery.js' %}"></script>
    <link rel="stylesheet" href="{% static 'css/bg.min.css' %}">
    <link rel="stylesheet" href="{% static 'css/sidebar.min.css' %}">
    <link rel="stylesheet" href="{% static 'css/toastify.css' %}">
    <link rel="stylesheet" href="{% static 'output/result.css' %}">
    <link rel="stylesheet" href="{% static 'css/main.css' %}">
    <link rel="stylesheet" href="{% static 'css/base.min.css' %}">
    <link rel="stylesheet" href="{% static 'css/loading.min.css' %}">


 {% block static %}


 {% endblock static %} 
</head>
<body  class="bg-base-lightbg dark:bg-base-darkbg h-full w-full">           
    <!-- preview upload -->
    <div id="uploadPreview" class=" hidden w-full">
        <div class="fixed inset-0 flex items-center justify-center z-50">
            <div class="fixed inset-0 bg-black/75"></div>
            <div class="w-full z-50 flex flex-col items-center justify-center">
                <img id="uploadPreviewImage" src="#" alt="Profile Picture Preview" class="h-[450px] w-[80%] md:w-[50%]">   
                <div class="w-full flex gap-5 justify-center">
                    <button type="submit" id="uploadsubmitButton" class="w-fit py-2 px-10 mt-2 rounded-xl  text-white bg-green-600 cursor-pointer" >Continue</button>
                    <button type="submit" id="uploadcancelButton" class="w-fit py-2 px-10 mt-2 rounded-xl  text-white bg-green-600 cursor-pointer" >Cancel</button>
                </div>
            </div>
        </div>
    </div>

    <!-- create post modal -->
    <div id="modal" class="relative hidden w-full">
        <div class="fixed inset-0 flex items-center justify-center z-50">
            <div class="fixed inset-0 bg-black/75"></div>
            <div class="bg-white dark:bg-base-darkbgvariant w-[80%] md:w-[50%] rounded-lg z-50 absolute">
                <div class="flex items-center gap-6 pl-4">
                    <img src="{{request.user.prof_pics.url}}" class="w-[45px] h-[45px] rounded-full mt-7">
                    <p class="dark:text-gray-100 mt-4">Make a post</p>
                </div>
                <form method="POST" id="postform" enctype="multipart/form-data" class="pl-0 sm:pl-7">
                    {% csrf_token %}            
                    <!-- Content field -->
                    <div>
                      <textarea id="id_content" name="content" rows="4" cols="50" placeholder="write your post..." class="bg-transparent outline-none text-[#0d2438] dark:text-gray-300 ml-16"></textarea>
                    </div>
                    
                    <!-- File field -->
                    <div class="file-input-container">
                        <input type="file" id="id_filepost" name="file" class="hidden" >
                        <label for="id_filepost" class="post-file-icon-label">
                            <span class="material-icons"><i class="fa-solid fa-file-image text-[#0d2438] dark:text-white pl-4" style=" font-size: 50px; cursor: grab;"></i></span> <!-- Replace with your icon -->
                        </label>
                        <div id="postparentmodalpreview"  class="hidden">
                            <div id="post-preview-cancel" class="float-right cursor-pointer ml-2 text-red-600">x</div>
                            <img id="postmodalpreview" src="#" alt="" class="w-[50px] h-[50px]">
                        </div>
                    </div>
                     <!-- <button type="submit">Submit</button> -->
                </form>
                <div class="w-full justify-center flex gap-9 mt-6 pb-3">                       
                    <button id="submit" type="button" class=" bg-green-600 hover:bg-green-500 text-white font-bold py-2 px-4 rounded">
                        Post
                    </button>
                    <button id="button" class="bg-green-600 hover:bg-green-500 text-white font-bold py-2 px-4 rounded">
                        Close Modal
                    </button>
                </div>
            </div>
        </div>
    </div>            
    <!-- create status -->
    <div id="statusmodal" class="relative hidden w-full">
        <div class="fixed inset-0 flex items-center justify-center z-50">
            <div class="fixed inset-0 bg-black/75"></div>
            <div class="bg-white dark:bg-base-darkbgvariant w-[80%] md:w-[50%] rounded-lg z-50 ">
                <div class="flex items-center gap-6 pl-4">
                    <img src="{{request.user.prof_pics.url}}" class="w-[45px] h-[45px] mt-7 rounded-full">
                    <p class="dark:text-gray-100 mt-4">Create your status</p>
                </div>
                <form method="POST" id="statusform" enctype="multipart/form-data" class="pl-0 sm:pl-7">
                    {% csrf_token %}            
                    <!-- Content field -->
                    <div>
                      <textarea id="status_content" name="text" rows="4" cols="50" placeholder="write your post..." class="bg-transparent outline-none text-[#0d2438] dark:text-gray-300 ml-16"></textarea>
                    </div>
                    
                    <!-- File field -->
                    <div class="status-file-input-container ">
                        <input type="file" id="id_filestatus" name="file" class="hidden">
                        <label for="id_filestatus" class="status-file-icon-label">
                            <span class="material-icons"><i class="fa-solid fa-file-image text-[#0d2438] dark:text-white pl-4" style="font-size: 50px; cursor: grab;"></i></span> <!-- Replace with your icon -->
                        </label>
                        <div id="statusparentmodalpreview"  class="hidden">
                            <div id="status-preview-cancel" class="float-right cursor-pointer ml-2 text-red-600">x</div>
                            <img id="statusmodalpreview" src="#" alt="" class="w-[50px] h-[50px]">
                        </div>
                    </div>
                </form>
                    <!-- <button type="submit">Submit</button> -->
                <div class="mt-6 pb-3 flex  gap-4 justify-center">                       
                <button id="statussubmit" type="button" class=" bg-green-600 hover:bg-green-500 text-white font-bold py-2 px-4 rounded">
                    Post
                </button>
                <button id="statusbutton" class="bg-green-600 hover:bg-green-500 text-white font-bold py-2 px-4 rounded">
                    Close Modal
                </button>
                </div>
            </div>
        </div>
    </div>

    <div id="loadingmodal" class="relative w-full">
        <div class="fixed inset-0 flex items-center justify-center z-50">
            <div class="fixed inset-0 dark:bg-black bg-white"></div>
                <div class="ripple"></div>
            </div>
    </div>

     <!-- creategroup modal -->
    <div id="creategroupmodal" class="relative hidden w-full">
        <div class="fixed inset-0 flex items-center justify-center z-50 ">
            <div class="fixed inset-0 bg-black/75"></div>
            <div class="bg-base-lightbgvariant dark:bg-base-darkbgvariant w-[80%] md:w-[50%] rounded-lg relative ">
                <div class="flex items-center gap-6 pl-4">
                        <img src="{{request.user.prof_pics.url}}" class="w-[45px] h-[45px] rounded-full mt-7">
                </div>
                <div class="w-full">
                    <form method="POST" id="groupform" enctype="multipart/form-data" class="w-full text-center">
                        {% csrf_token %}            
                        <!-- Content field -->
                        <div class="w-full grid items-center justify-center gap-y-7 mt-3 md:mt-0">
                            <input id="id_name" name="group_name" placeholder="group name" class="md:w-[350px] w-[100%] h-[40px] bg-transparent pl-2 rounded-lg outline-none text-[#0d2438] dark:text-gray-300 border dark:border-white">
                            <input id="id_description" name="group_id_description" placeholder="Write about yourgroup" class=" w-[100%] md:w-[350px] h-[40px] bg-transparent  pl-2 rounded-lg outline-none text-[#0d2438] dark:text-gray-300 border dark:border-white">
                        </div>
                    
                        <!-- File field -->
                        <p class="text-gray-500 text-sm mt-2"> Upload a cover photo</p>
                        <div class="group-file-input-container mt-3">
                            <input type="file" id="group_id_file" name="file" class="hidden">
                            <label for="group_id_file" class="group-file-icon-label">
                                <span class="material-icons"><i class="fa-solid fa-file-image text-[#0d2438] dark:text-white" style="font-size: 50px; cursor: grab;"></i></span> <!-- Replace with your icon -->
                            </label>
                            <div id="parentmodalpreview"  class="hidden">
                                <div id="group-preview-cancel" class="float-right cursor-pointer ml-2">x</div>
                                <img id="modalpreview" src="#" alt="" class="w-[50px] h-[50px]">
                            </div>
                        </div>
                        
                        <!-- Submit button -->
                    </form>
                    <div class="mt-6 pb-3 flex  gap-4 justify-center">                       
                        <button id="groupsubmit" type="submit" class=" bg-green-600 hover:bg-green-500 text-white font-bold py-2 px-4 rounded">
                            Create
                        </button>
                        <button id="groupcancel" class="bg-green-600 hover:bg-green-500 text-white font-bold rounded bottom-4 py-2 px-4">
                            Cancel
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <div id="baseuserid" data-id="{{request.user.id}}" class="hidden">{{request.user.username}}</div>

    <!-- main display page starts here -->
    <div class="w-full h-full flex bg-base-lightbg dark:bg-base-darkbg">
    
        <!-- left nav -->
        <div id="leftnav" class="hidden md:block bg-base-lightbg dark:bg-base-darkbg  w-[200px] h-full border-r border-gray-300 fixed ">
            {% include 'hometweet/leftnav.html' %}
        </div>   

        <!-- top mobile nav -->
        <div class="w-full md:hidden  fixed bg-base-lightbg dark:bg-base-darkbg top-0 h-fit py-5  z-20 ">
            <div class="w-full flex justify-between">
                <div id="home"> 
                    <h1 class="ml-4 text-[#0d2438] dark:text-white cursor-pointer"><i class="fa fa-bars" aria-hidden="true"></i>
                    </h1>
                </div>
                <div class="w-fit mr-4 flex gap-3 items-center">                  
                    <form method="get" class="relative" id="topsearchButtonform">
                        <input type="text" 
                        placeholder="Search"
                        name="query"
                        id="topsearchButton"
                        class="text-[#0d2438] dark:text-gray-300 bg-transparent border-2 bg-0 outline-none border-[#0d2438] dark:border-gray-300 rounded-xl pl-3 h-[28px] ">
                        <div class="absolute top-0 right-2" style="top: 2px;">
                            <i class="fa fa-search text-[#0d2438] dark:text-white cursor-pointer" aria-hidden="true"></i>
                        </div>               
                    </form> 
                    <a href="{% url 'notification_view' %}">
                        <div id="bellicon2container" class="relative text-[#0d2438] dark:text-white ">
                            <i class="fa fa-bell cursor-pointer " aria-hidden="true"></i>                           
                            <div id="bellicon2"  class="rounded-full bg-red-600 text-white flex items-center justify-center" style="height: 22px; width: 22px; font-size: 13px;position: absolute; right: -8px; top: -10px"></div>
                        </div>        
                    </a>
                </div>
            </div>
            <!-- search modal -->
            <div id="searchmodalparent" class="hidden absolute w-[80%] h-fit py-4 transform translate-x-[13%] rounded-b-lg z-50 bg-white dark:bg-base-darkbgvariant">
                <div id="searchmodalcancel" class="w-full text-right text-lg text-red-600 cursor-pointer pr-4"> X</div>
                <div id="searchmodal" class="h-fit w-full text-[#0d2438] dark:text-gray-300 flex flex-col justify-center items-center gap-4">
                </div>
            </div>
        </div>
    
        <!-- mobile sidebar -->
        <div id="sidebar" class="md:hidden fixed h-full ">
            <div class="md:hidden fixed bg-white dark:bg-base-darkbgvariant h-full">
                <p id="sidebarCancel" class="my-5 ml-6"><i class="fa-solid fa-xmark text-[#0d2438] dark:text-gray-300 cursor-pointer"></i></p>
                <div class="px-4 pb-3">
                    <img src="{{ request.user.prof_pics.url}}" class="w-[50px] h-[50px] rounded-full mt-7">
                    <div id="leftnavusername" class=" text-[#0d2438] dark:text-gray-300 my-1">{{ request.user.username }}</div>           
                    <div>
                        <input type="checkbox" class="checkbox opacity-0 absolute" id="checkbox">
                        <label for="checkbox" class="checkbox-label bg-transparent w-[50px] rounded-lg relative p-1 cursor-pointer flex justify-between items-center border border-gray-300 dark:border-gray-600 ">
                            <i class="fas fa-sun text-red-700 "></i>
                            <i class="fas fa-moon text-red-700 "></i>
                        <span id="ball2"></span>
                        </label>
                    </div>
                </div>
                <ul class="grid mt-2" style="gap: 4rem;">
                    <li>
                        <div class="flex  text-[#0d2438] dark:text-gray-300 px-4 hover:bg-base-lightbgvariant dark:hover:bg-base-darkbgvariant rounded-lg cursor-pointer"><i class="fa fa-sign-out" aria-hidden="true" style="margin-top: 3.5px; margin-right: 5px"></i>Logout</div>
                    </li>
                    <li>
                        <div class="flex  text-[#0d2438] dark:text-gray-300 px-4 hover:bg-base-lightbgvariant dark:hover:bg-base-darkbgvariant rounded-lg cursor-pointer"><i class="fa fa-cog" aria-hidden="true" style="margin-top: 3.5px; margin-right: 5px"></i>Settings</div>
                    </li>
                    <li>
                        <div class="flex  text-[#0d2438] dark:text-gray-300 px-4 hover:bg-base-lightbgvariant dark:hover:bg-base-darkbgvariant rounded-lg cursor-pointer"><i class="fa fa-sign-out" aria-hidden="true" style="margin-top: 3.5px; margin-right: 5px"></i><a href="{% url 'find_friends_templates' %}">Find friends</a></div>
                    </li>
                    <li>
                        <div id="logout2" class="flex  text-[#0d2438] dark:text-gray-300 px-4 hover:bg-base-lightbgvariant  dark:hover:bg-base-darkbgvariant rounded-lg cursor-pointer"><i class="fa fa-sign-out" aria-hidden="true" style="margin-top: 3.5px; margin-right: 5px"></i>Logout</div>
                    </li>
                </ul>
            </div>
        </div> 

        <!-- home -->
        <div id="middleblock" class="home  w-full h-full mt-20 md:mt-0 mb-28 md:w-[70%] xl:w-[65%] bg-base-lightbg dark:bg-base-darkbg">
            {% block content %}
            {% endblock content %}
        </div>
   

        <!-- mobile nav -->
        <div class="md:hidden fixed rounded-tr-xl rounded-tl-xl bg-white dark:bg-base-darkbgvariant bottom-0 w-full h-fit py-5 z-99 ">
            <div class="w-full flex justify-evenly">
                <a href="{% url 'home' %}"><i class="fa fa-home text-[#0d2438] dark:text-white cursor-pointer" aria-hidden="true"></i></a>
                
                <a href="{% url 'profile' name=request.user.username %}"><i class="fa fa-user text-[#0d2438] dark:text-white cursor-pointer" aria-hidden="true"></i></a>
                    
                <div x-data="{ open: false }" class="relative">
                    <div @click="open = true">
                        <i class="fa fa-plus-circle text-green-600 cursor-pointer text-4xl" aria-hidden="true" ></i>
                    </div>
                    <template x-if="open">
                        <div
                            @click.away="open = false"
                            x-transition:enter="transition ease-out origin-bottom-left duration-200"
                            x-transition:enter-start="opacity-0 transform scale-90 translate-y-2"
                            x-transition:enter-end="opacity-100 transform scale-100"
                            x-transition:leave="transition origin-bottom-left ease-in duration-100"
                            x-transition:leave-start="opacity-100 transform scale-100"
                            x-transition:leave-end="opacity-0 transform scale-90 translate-y-2"
                            class="absolute shadow-sm p-5 max-w-sm ml-2 bg-base-lightbgvariant dark:bg-base-darkbgvariant rounded-lg"
                            style="top:-10rem;"
                        >
                            <button id="mobilecreatepost" onclick="mobilecreatepost()" class="a w-full py-2 text-sm text-[#0d2438] dark:text-gray-300 hover:text-gray-500 mb-2 cursor-pointer">Post</button>
                            <button id="mobilecreatestatus" onclick="mobilecreatestatus()" class="b w-full py-2 text-sm text-[#0d2438] dark:text-gray-300 hover:text-gray-500 cursor-pointer" >Status</button>
                            <button id="mobilecreatgroup" onclick="mobilecreatgroup()"  class="c w-full py-2 text-sm text-[#0d2438] dark:text-gray-300 hover:text-gray-500 cursor-pointer" >Group</button>
                        </div>
                    </template>
                </div>

                <div id="topmessagenav" class="relative">
                    <a href="{% url 'chatintialmessage' %}"><i class="fa fa-envelope-open text-[#0d2438] dark:text-white cursor-pointer" aria-hidden="true"></i></a>
                    <div id="messagenotif2" class="hidden rounded-full bg-red-600" style="height: 22px; width: 22px; font-size: 13px;position: absolute; right: -8px; top: -8px"></div>
                </div>
                <a href="{% url 'allgroups' %}"><i class="fa fa-users text-[#0d2438] dark:text-white cursor-pointer" aria-hidden="true"></i></a>
            </div>
            
        </div>

            <!-- right nav -->
        <div id="righnav" class="hidden border-l border-gray-300 fixed h-full right-1 xl:block w-[20%] bg-base-lightbg dark:bg-base-darkbg" >
            {% include 'hometweet/rightnav.html' %}
        </div>

   

        <script src="{% static 'js/main.js' %}"></script> 
        <script src="{% static 'usedJsCode/base.js' %}"></script> 
        <!-- <script>
    document.addEventListener("DOMContentLoaded", function(){
   
   let processenv = 'http://127.0.0.1:8000'
   // Create an array to convert month index to month abbreviation
   let currentDate = new Date();
   let day = currentDate.getDate();
   let monthIndex = currentDate.getMonth();
   // let year = currentDate.getFullYear();
   let hours = currentDate.getHours();
   let minutes = currentDate.getMinutes();
   let monthNames = ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"];
   let formattedDate = day + ' ' + monthNames[monthIndex] + ' ' + hours + ':' + (minutes < 10 ? '0' : '') + minutes;
      
   const topsearchButton = document.querySelector('#topsearchButton');
   const modal = document.querySelector('#modal');   
   // const submitButton = document.querySelector('#submit');
   const groupcancel = document.querySelector('#groupcancel');
   const creategroupmodalbase = document.querySelector('#creategroupmodal');
   const grouppagecreategroup = document.querySelector('#grouppagecreategroup');
   const topsearchmodal = document.querySelector('#searchmodal');
   const searchmodalparent = document.querySelector('#searchmodalparent');
   const searchmodalcancel = document.querySelector('#searchmodalcancel');
   const protocol = window.location.protocol === 'https:' ? 'wss:' : 'ws:';
    const urls = `${protocol}//${window.location.host}/ws/home/`
    // let messages = document.querySelector('#online')
    let onlinePeople = document.querySelector('#online-people')
    const chatChat= document.querySelector("#chat-chat")
    // const messageHolder= document.querySelector("#container")
    const messageStore= document.querySelector("#messageStore")
    // const img= document.querySelector("#img")
    const samePerson= document.querySelector("#baseuserid").innerHTML
    const chats = document.querySelector('#chat');
    const senddiv = document.querySelector('#sendiv');
    const realtimemessg=document.querySelector("#realtimemessg")
    const onlinechat=document.querySelector("#onlinechat")
    const backarrow= document.querySelector("#backarrow")          
    const onlinechatbutton=document.querySelector("#onlinechatbutton")
    const logout = document.querySelector("#logout");
    const csrfToken2 = document.querySelector('[name="csrfmiddlewaretoken"]').value;
    const onlineSocket = new WebSocket(urls)
    const requestUser= document.querySelector("#baseuserid").getAttribute("data-id")
        
   let baseresponseUrlKey = 'http://127.0.0.1:8000'
   
   
   let baseTypingTimer;
   // const delaybase = 85000
        topsearchButton.addEventListener("input",  (e) => {
        clearTimeout(baseTypingTimer)
        typingTimer= setTimeout( async () => {
            e.preventDefault();
            searchmodalparent.style.display="block"
            const formData = new FormData(document.querySelector('#topsearchButtonform'));
            const searchParams = new URLSearchParams(formData);
            const url = 'https://django-channels-byf5.onrender.com/search' + '?' + searchParams.toString();
        
            const response = await fetch(url, {
                method: 'GET',
                headers: {
                    'X-CSRFToken': '{{ csrf_token }}',
                },
            });
            // document.querySelector("#rightnavcancel").style.display="block"
            // );
                const data = await response.json();
                topsearchmodal.innerHTML=""
                if(data.results.length>=1){ 
                        data.results.slice(0, 3).forEach(item => {
                        let parentdiv= document.createElement("div")
                        let buttonparentdiv= document.createElement("div")
                        let namesparentdiv= document.createElement("div")
                        // let imageparentdiv= document.createElement("div")
                        let profPics= document.createElement("img")
                        let username= document.createElement("p")
                        let bio= document.createElement("p")
                        let viewProfile= document.createElement("p")
                        let addfriend= document.createElement("p")
                        parentdiv.style.width="80%"
                        parentdiv.style.padding="1.5rem 0"
                        parentdiv.style.height="fit-content"
                        parentdiv.style.position="relative"
                        parentdiv.style.borderRadius="10px"
                        parentdiv.style.minHeight="108px"
        
                        profPics.style.width="60px"
                        profPics.style.height="60px"
                        profPics.style.borderRadius="50%"
                        profPics.style.position="absolute"
                        profPics.style.left="4%"
                        profPics.style.zIndex="20"
        
        
                        // profPics.style.paddingLeft="7%"
                        username.style.color="limegreen"
                        username.style.width="100%"
                        username.style.textAlign="center"
        
        
                        
                        bio.style.color="white"
                        bio.style.width="100%"
                        bio.style.textAlign="center"        
        
                        viewProfile.style.height="fit-content"
                        viewProfile.style.width="fit-content"
                        viewProfile.style.padding="5px"
                        viewProfile.style.color="white"
                        viewProfile.style.borderRadius="5px"
                        viewProfile.style.backgroundColor="limegreen"
                        viewProfile.style.zIndex="20"
                        viewProfile.style.marginTop="8px"
                        viewProfile.style.cursor="pointer"
                        viewProfile.innerHTML="View"
        
                        
                        namesparentdiv.style.display="grid"
                        namesparentdiv.style.backgroundColor="black"
                        namesparentdiv.style.opacity="0.4"
                        namesparentdiv.style.backdropFilter="blur(2px)"
                        namesparentdiv.style.position="absolute"
                        namesparentdiv.style.bottom="0"
                        namesparentdiv.style.width="100%"
                        namesparentdiv.style.height="50%"
                        namesparentdiv.style.borderRadius="5px"
                        namesparentdiv.style.paddingBottom="3x"
                        parentdiv.style.background= "white"
        
                        if(item.prof_pics && item.username){
                            bio.innerHTML=item.bio
                            username.innerHTML=item.username
                            profPics.src= item.prof_pics
                            parentdiv.append(profPics)
                            viewProfile.onclick=function(){
                                window.location.href=`${processenv}/profile/${item.username}/ `
                            }
                            
                        }else if(item.prof_pics && item.owner){
                            username.innerHTML=item.content
                            viewProfile.onclick=function(){
                                window.location.href=`${processenv}/comments/${item.slug}/ `
                            }                                   
                        }
                        else{
                            username.innerHTML=item.name
                            profPics.src= item.photo
                            parentdiv.append(profPics)
                            viewProfile.onclick=function(){
                                window.location.href=`${processenv}/group-view/${item.name}/ `
        
                            } 
                            
                        }
                        namesparentdiv.append(username)
                        namesparentdiv.append(bio)
        
                        buttonparentdiv.append(viewProfile)
                        buttonparentdiv.style.position="absolute"
                        buttonparentdiv.style.right="4%"
                        buttonparentdiv.style.top="6%"
                        buttonparentdiv.style.zIndex="10"
                        
                        // buttonparentdiv.append(imageparentdiv)
                        parentdiv.append(buttonparentdiv)
                        parentdiv.append(namesparentdiv)
                        topsearchmodal.append(parentdiv)
                    });  
                    let seeAll= document.createElement("p")
                    seeAll.innerHTML="See all"
                    seeAll.style.marginTop = '1rem';
                    seeAll.style.width = '75%';
                    seeAll.style.backgroundColor = 'white'; // Set background color
                    seeAll.style.color = '#0d2438';
                    seeAll.style.textAlign = 'center';
                    seeAll.style.cursor = 'pointer';
                    seeAll.style.border = '1px solid #00cc66';
                    seeAll.style.padding = '0.5rem 0';
                    seeAll.style.borderRadius = '10px';
                    seeAll.style.color = '#0d2438';
                    
        
                    topsearchmodal.append(seeAll)
                    seeAll.addEventListener('mouseenter', function () {
                        seeAll.style.backgroundColor = '#16a34a'; // Change background color on hover
                        seeAll.style.color = 'white';
                    });
        
                    seeAll.addEventListener('mouseleave', function () {
                        seeAll.style.backgroundColor = 'white'; // Reset background color on mouse leave
                        seeAll.style.color = '#0d2438';
                    });
                    seeAll.addEventListener("click",  async(e) => {
                        const url = '{% url "search" %}' + '?' + searchParams.toString();
                        window.location.href='{% url "search_view_template" %}' + '?' + searchParams.toString();
                    })                         
                }else{
                    topsearchmodal.innerHTML= "Search not found"
                }
            
        })                                                       
        
        })
        
        searchmodalcancel.addEventListener("click",  (e) => {
        topsearchmodal.innerHTML=""
        searchmodalparent.style.display="none"
        
        })
        
        
        
        let mobilecreatepost = document.querySelector('#mobilecreatepost');
        let hy = document.querySelector('.hy'); 
        mobilecreatepost.onclick = ()=>{
            console.log(mobilecreatepost)
            console.log('heiyaa')
            modal.style.display='block'
            document.querySelector('#id_content').focus();
        
        }
        
        
        function mobilecreatgroup(){
            creategroupmodalbase.style.display='block'
        }
        function mobilecreatestatus(){
        statusmodal.style.display='block'
        document.querySelector('#id_content').focus();
        
        }
        
        groupcancel.addEventListener("click", ()=>{creategroupmodalbase.style.display='none'})
        if(grouppagecreategroup){
        grouppagecreategroup.addEventListener("click", ()=>{
            creategroupmodalbase.style.display='block'
        })
        }
   
   //    bg change
   
        const body = document.querySelector('body');
        const btn = document.querySelector('#ball');
        const btn2 = document.querySelector('#ball2');
        const left = document.querySelector('#leftnav');
            
        // Retrieve mode value from local storage if it exists
        const savedMode = localStorage.getItem('mode');
        
        if (savedMode !== null) {
        body.classList.add(savedMode)
        if(savedMode==="light"){
            btn.classList.add("balllight");
            btn2.classList.add("balllight");
        }else{
            btn.classList.add("balldark");
            btn2.classList.add("balldark");
        
        }
        }else{
        btn.classList.add("balllight");
        btn2.classList.add("balllight");
        }
        
   const toggleDarkMode = () => {
   body.classList.toggle('dark');
   // Store the mode value in local storage
   const mode = body.classList.contains('dark') ? 'dark' : 'light';
   localStorage.setItem('mode', mode);
   if(mode==="light"){
       btn.classList.remove("balldark");
       btn.classList.add("balllight");
       btn2.classList.remove("balldark");
       btn2.classList.add("balllight");
       let store1=document.querySelectorAll("#findfrienddivbg")
       for(let i of store1){
           i.style.backgroundColor="white"
       }
   
       let store2= document.querySelectorAll("#frienddivbg")
       for(let x of store2){
           x.style.backgroundColor="white"
       }
   
   }else{
       btn.classList.remove("balllight");
       btn.classList.add("balldark");
       btn2.classList.remove("balllight");
       btn2.classList.add("balldark");
       let store1=document.querySelectorAll("#findfrienddivbg")
       for(let i of store1){
           i.style.backgroundColor="#1D2833"
       }
   
       let store2= document.querySelectorAll("#frienddivbg")
       for(let x of store2){
           x.style.backgroundColor="#1D2833"
       }
   
   
   
   }
   
   };
   if(btn){
   btn.addEventListener('click', toggleDarkMode);            
   btn2.addEventListener('click', toggleDarkMode);            
   }
        
        //    chatting logic and notification
        let addnotif
        if(localStorage.getItem("notificationadd") != undefined){
        addnotif=localStorage.getItem("notificationadd")
        }else{
        addnotif=0
        }
        let bellicon2= document.querySelector("#bellicon2")
        const bell=document.querySelector("#bellicon")
        
        if(bellicon2){
            bellicon2.style.display="none"
        } 
        if(bell){
            bell.style.display="none"
        }  
        let increase= bell.innerHTML
        
        let dbnotif;
        let logout_notification;
        let message_logout_notification;
        let messagenotifrightnav;
        const savedCount = localStorage.getItem('count');
        let messagenotif2= document.querySelector("#messagenotif2")
        let count;
        let notifTotal;
        let profile_message = document.querySelector('#profile_message');
        
        
        
        
        let suggestions= document.querySelector("#suggestions")
        // rightnav findfriends
        let xhrfriends = new XMLHttpRequest();
        let url = `${processenv}/findfriends/`
        xhrfriends.open('GET',  url, true);
        xhrfriends.setRequestHeader('Content-Type', 'application/json');
        xhrfriends.onreadystatechange = function () {
        if (xhrfriends.readyState === XMLHttpRequest.DONE && xhrfriends.status === 200) {                          
                let baseresponse= JSON.parse(xhrfriends.responseText)
                baseresponse.find_friends.slice(0, 3).forEach(item => {
                    if(baseresponse.sent.includes(item.username) || baseresponse.received.includes(item.username)){
                                
                    }
                    else{ 
                        if(item.username !== ""){
                        let parentdiv= document.createElement("div")
                        let buttonparentdiv= document.createElement("div")
                        let namesparentdiv= document.createElement("div")
                        // let imageparentdiv= document.createElement("div")
                        let profPics= document.createElement("img")
                        let username= document.createElement("p")
                        let bio= document.createElement("p")
                        let viewProfile= document.createElement("p")
                        let addfriend= document.createElement("p")
                        parentdiv.style.width="80%"
                        parentdiv.style.padding="1.5rem 0"
                        parentdiv.style.height="fit-content"
                        parentdiv.style.position="relative"
                        parentdiv.style.backgroundColor="transparent"
        
                        // parentdiv.style.backgroundImage= "url("+ item.cover +")"
                        parentdiv.style.border="0.8px solid #635a5aab"
                        parentdiv.style.borderRadius="10px"
                        parentdiv.style.minHeight="108px"
        
                        profPics.src= item.pics
                        profPics.style.width="60px"
                        profPics.style.height="60px"
                        profPics.style.borderRadius="50%"
                        profPics.style.position="absolute"
                        profPics.style.left="4%"
                        profPics.style.zIndex="20"
        
        
                        parentdiv.append(profPics)
                        // profPics.style.paddingLeft="7%"
                        username.innerHTML=item.username
                        username.style.color="white"
                        username.style.width="100%"
                        username.style.textAlign="center"
        
        
                        bio.innerHTML="item.bio"
                        bio.style.color="white"
                        bio.style.width="100%"
                        bio.style.textAlign="center"
        
                        addfriend.innerHTML="Add"
                        viewProfile.innerHTML="View"
                        addfriend.style.height="fit-content"
                        addfriend.style.width="fit-content"
                        addfriend.style.padding="5px"
                        addfriend.style.color="white"
                        addfriend.style.backgroundColor="limegreen"
                        addfriend.style.borderRadius="5px"
                        addfriend.style.cursor="pointer"
        
                        viewProfile.style.height="fit-content"
                        viewProfile.style.width="fit-content"
                        viewProfile.style.padding="5px"
                        viewProfile.style.color="white"
                        viewProfile.style.borderRadius="5px"
                        viewProfile.style.backgroundColor="limegreen"
                        viewProfile.style.zIndex="20"
                        viewProfile.style.marginTop="8px"
                        viewProfile.style.cursor="pointer"
                        viewProfile.onclick=function(){
                            window.location.href=`${baseresponseUrlKey}/profile/${item.username}/ `
                        }
        
                        addfriend.onclick=function(){
                            window.location.href=`${baseresponseUrlKey}/addfriends/${item.username}/ `
                        }
        
                        
                        namesparentdiv.style.display="grid"
                        namesparentdiv.style.backgroundColor="black"
                        namesparentdiv.style.opacity="0.4"
                        namesparentdiv.style.backdropFilter="blur(2px)"
                        namesparentdiv.style.position="absolute"
                        namesparentdiv.style.bottom="0"
                        namesparentdiv.style.width="100%"
                        namesparentdiv.style.height="50%"
                        namesparentdiv.style.borderRadius="5px"
                        namesparentdiv.style.paddingBottom="3x"
                        namesparentdiv.append(username)
                        namesparentdiv.append(bio)
        
                        buttonparentdiv.append(addfriend)
                        buttonparentdiv.append(viewProfile)
                        buttonparentdiv.style.position="absolute"
                        buttonparentdiv.style.right="4%"
                        buttonparentdiv.style.top="6%"
                        buttonparentdiv.style.zIndex="10"
                        
                        // buttonparentdiv.append(imageparentdiv)
                        parentdiv.append(buttonparentdiv)
                        parentdiv.append(namesparentdiv)
                        suggestions.append(parentdiv)
                        }
                    }            
                });
                dbnotif = baseresponse.notif
                logout_notification= baseresponse.logout_notification
                message_logout_notification= baseresponse.logout_message_notification
                messagenotifrightnav = baseresponse.message_notif
                
        
                
                if(savedCount){
                    count=savedCount
                    // if(+savedCount >0){
                    //     messagenotif2.style.display="block" 
                    // }
                } 
                else{
                    count=0
                }
        
                if( count>=1 || +(messagenotifrightnav) >=1 || +(message_logout_notification)>=1){
                    let messagenotif= document.querySelector("#messagenotif")
                    let messageTotalNotif= +(count) + (+messagenotifrightnav) + (+message_logout_notification)
                    if(messagenotif !== null){
                        messagenotif.innerHTML=messageTotalNotif
                        messagenotif.style.color="white"
                        messagenotif.style.display="flex"
                        messagenotif.style.justifyContent="center"
                        messagenotif.style.alignItems="center"
                        localStorage.setItem("count", messageTotalNotif)
                    }
                    if(messagenotif2 !== null){
                        messagenotif2.innerHTML=+(count) + +(messagenotifrightnav)
                        messagenotif2.style.color="white"
                        messagenotif2.style.display="flex"
                        messagenotif2.style.justifyContent="center"
                        messagenotif2.style.alignItems="center"
                    }
                }
                if( addnotif !== null){
                    notifTotal= +(addnotif) +  +(dbnotif)
                    
                    localStorage.setItem("notificationadd", notifTotal)
                    if(bell){
                        bell.innerHTML=notifTotal
                    }
        
                    if(bellicon2){
                        bellicon2.innerHTML=notifTotal
                    }                        
                }else{
                    let offline_notif_total= +logout_notification + +(dbnotif)
                    
                    if(offline_notif_total > 0){
                        notifTotal= +offline_notif_total
                        if(bell){
                            bell.innerHTML= offline_notif_total
                        }
                        if(bellicon2){
                            bellicon2.innerHTML=offline_notif_total  
                        }
                    }
                    localStorage.setItem("notificationadd", notifTotal)
                    
                }
                if(notifTotal<=0 ){
                    if(bell){
                        bell.style.display="none"
                    }
                    if(bellicon2){
                        bellicon2.style.display="none"
                    }
                }else{
                    if(bell){
                        bell.style.display="flex"
                    }
                    if(bellicon2){
                        bellicon2.style.display="flex"
                    }
                }
        
                let xhr2 = new XMLHttpRequest();
                xhr2.open('GET',  `${processenv}/reset_notif/`, true);
                xhr2.setRequestHeader('Content-Type', 'application/json');
                xhr2.onreadystatechange = function () {
                    if (xhr2.readyState === XMLHttpRequest.DONE) {
                        if( xhr2.status === 200){
                            response= JSON.parse(xhr2.responseText)
                        }
                    }
                }
                xhr2.send()
        
                
                let bellicon2container =document.querySelector("#bellicon2container")
                if(bellicon2container){
                    bellicon2container.onclick= function(){
                        // localStorage.removeItem
                        localStorage.removeItem('notificationadd')
                        bellicon2.style.display="none"
                    }
        
                }
                let belliconcontainer =document.querySelector("#belliconcontainer")
                if(belliconcontainer){
                    belliconcontainer.onclick= function(){
                        // localStorage.removeItem
                        localStorage.removeItem('notificationadd')
                        bell.style.display="none"
                    }
        
                }
        }
        }
        xhrfriends.send()
        
        
        
        // let bgStatus;
        
        if(localStorage.getItem("mode")==="dark"){
        bgStatus="dark"
        }else{
        bgStatus="light"
        }
        
        
        function checksize(){
        let screenWidth = window.innerWidth || document.documentElement.clientWidth || document.body.clientWidth;
        
        let backarrowState;
        if(backarrow){
            backarrowState=backarrow.getAttribute("state")
        
        }
        
        if(realtimemessg && onlinechat){            
            if(screenWidth<640 && backarrowState===null){
                onlinechat.style.display="block"
                realtimemessg.style.display="none"
            }else if(screenWidth<640 && backarrowState==="false"){
                onlinechat.style.display="block"
                realtimemessg.style.display="none"
            }
            else{               
                onlinechat.style.display="none"
                realtimemessg.style.display="block"
        
            }
        }
            
        if(onlinechat){ 
            if(screenWidth>640){
                onlinechat.style.display="block"
        
            }
        }
        
        }
        
        checksize()
        
        function screenResize(){
        checksize()
        }
        
        function scrollToBottom() {
        messageStore.scrollTop = messageStore.scrollHeight;
        }
        
        
        window.addEventListener("resize", screenResize)
        if(backarrow){
        backarrow.onclick= function(){
            backarrow.setAttribute("state", "false")
            realtimemessg.style.display="none"
            onlinechat.style.display="block"
            onlinechatbutton.style.display="flex"
        }
        
        }
        let socket=null;
        
        if( chats ){
        chats.onmouseover= function(){
            chats.style.opacity="0.4"
        }
        chats.onmouseout= function(){
            chats.style.opacity="1"
        }
        }
        if(senddiv){
        
        senddiv.onmouseover= function(){
            senddiv.style.opacity="0.4"
            senddiv.style.cursor="pointer"
        }
        senddiv.onmouseout= function(){
            senddiv.style.opacity="1"
        }
        }
        
        // online.onmouseover= function(){
        //     online.style.opacity="0.4"
        // }
        // online.onmouseout= function(){
        //     online.style.opacity="1"
        // }
        
        let typingStore;
        function initialPersonalChat(receiver){
        let xhr = new XMLHttpRequest();
        xhr.open('GET',  `${baseresponseUrlKey}/chat/${receiver}`, true);
        xhr.setRequestHeader('Content-Type', 'application/json');
        ;
        
        xhr.onerror = function () {
            ;
        };
        
        xhr.onreadystatechange = function () {
            if (xhr.readyState === XMLHttpRequest.DONE) { 
                if( xhr.status === 200){
                ;
                response= JSON.parse(xhr.responseText)
                let obj=JSON.parse(response.context)
                if(response.context){
                    for(i of obj){
                        const firstKey= Object.keys(i)[0]
                        const firstValue= i[firstKey]
                        let chat=document.createElement('p');
                        messageStore.style.opacity="1"
                        chat.style.width="fit-content"
                        chat.style.padding="3px 10px"
                        chat.style.marginTop="1rem"
                        chat.style.borderRadius="10px"
                        chat.innerHTML = firstValue 
                        if( firstKey=== samePerson){
                            chat.style.alignSelf = "flex-end"
                            chat.style.backgroundColor="green"
                            chat.style.color="white"
                        }else{
                            chat.style.color="white"
                            chat.style.backgroundColor="#597d35"
                            
                        }                                                                                
                        
                    messageStore.appendChild(chat)
                    scrollToBottom()
                    
                    }
                    } 
                    
            
                }else{
                    ;
                }
            }
        }
        xhr.send()
        }
        
        
        function sendAndRceiveMessage(data, receiver){ 
        if(data.type==="chat_message"){              
            if(data.receiver===samePerson){
                let chatelementDiv= document.createElement('div')
                let time= document.createElement('p')
                time.innerHTML=data.time
                time.style.color="gray"
                time.style.display="none"
                time.style.fontSize="12px"
                let chat= document.createElement('p')
                chat.style.width="fit-content"
                chat.style.padding="3px 10px"
                chat.style.marginTop="1rem"
                chat.style.borderRadius="10px"
                if(data.receiver===samePerson){
                    chat.style.color="white"
                    chat.style.backgroundColor="#597d35"
                    chatelementDiv.style.alignSelf = "flex-start"
                    chatelementDiv.appendChild(chat)
                    chatelementDiv.appendChild(time)
                }else{
                    chatelementDiv.style.float = "right"
                }
                chat.onclick= ()=>{time.style.display = "block"}
                chat.innerHTML= data.message;
                if(messageStore){
                    messageStore.appendChild(chatelementDiv); 
                    scrollToBottom() 
                }
            }
        }   
        
        if(data.type==="same_message"){  
            let onlinesignal = data.online
            fetchData(onlinesignal)              
            let chat= document.createElement('p')
            let chatelementDiv= document.createElement('div')
            let time= document.createElement('p')
            time.innerHTML=data.time
            time.style.color="gray"
            time.style.display="none"
            time.style.fontSize="12px"
            chat.style.width="fit-content"
            chat.style.padding="3px 10px"
            chat.style.color="black"
            chat.style.marginTop="1rem"
            chat.style.borderRadius="10px"
            if(data.receiver !== samePerson){
                chat.style.backgroundColor="green"
                chat.style.color="white"
                chat.style.alignSelf = "flex-end"
                chat.style.float = "right"
                chatelementDiv.appendChild(chat)
                chatelementDiv.appendChild(time)
            }
            chat.onclick= ()=>{time.style.display = "block"}
            // else{
            //     chat.style.backgroundColor="green"
            //     chat.style.color="white"
            //     chat.style.alignSelf = "flex-end"
            // }
            chat.innerHTML= data.message;
            messageStore.appendChild(chatelementDiv);  
            scrollToBottom()
        }
        
        }
        
        
        function chatting(e, baseUserId, receiver){  
            const username2 = document.querySelector('#leftnavusername');
            let realtimemessg=document.querySelector("#realtimemessg")
            let onlinechat=document.querySelector("#onlinechat")
            let backarrow= document.querySelector("#backarrow")         
        
            if(messageStore !== null){
                messageStore.style.opacity="1"
            
            }
            let screenWidth = window.innerWidth || document.documentElement.clientWidth || document.body.clientWidth;    ;
            if(!profile_message){
                if(screenWidth<=640 && onlinechat !== null && backarrow !== null && realtimemessg !== null){
                    onlinechat.style.display="none"
                    realtimemessg.style.display="block"
                    realtimemessg.style.width="100%"
                    backarrow.setAttribute("state", "true")
                    
                }else{
                    onlinechat.style.display="block"
                    backarrow.setAttribute("state", "false")
            
                }
            }
            if (socket !== null && socket.readyState === WebSocket.OPEN) {
                socket.close();
            }  
            const newprotocol = window.location.protocol === 'https:' ? 'wss:' : 'ws:';
            const urls2 = `${newprotocol}//${window.location.host}/ws/messages/${baseUserId}/${receiver}/ `
            socket = new WebSocket(
                // 'ws://' + window.location.host + '/ws/messages/' + baseUserId + '/' + receiver +'/'
                urls2
            );
        
            socket.onmessage = function(e) {
                const data = JSON.parse(e.data);       
                sendAndRceiveMessage(data, receiver)                           
                // to get private initialmessages
                // initialChat(data)
                };
            
            socket.onclose = function(e) {
            };
        
            if(document.querySelector('#message') !== null ){
            document.querySelector('#message').focus();
            document.querySelector('#message').onkeyup = function(e) {
                if (e.key === 'Enter') {  // enter, return
                    if(document.querySelector('#leftnavusername').value !== ''){
                        document.querySelector('#chat-message-submit').click();
                    }
                    }
                }
            };

            if(document.querySelector('#message') !== null ){
                document.querySelector('#message').oninput = function(e) {
                    socket.send(JSON.stringify({
                        'message': "message",
                        "user":username2.innerHTML,
                        "receiver":receiver,
                        "receiverProfile":i,
                        "type":"typing"
                    
                    }));
                }; 
            }            
        
            if(document.querySelector('#message') !== null ){
                let blurTimeout;
                document.querySelector('#message').onblur = function(e) {
                    clearTimeout(blurTimeout)
                    // let countdown=0
                    // function
                        const username2 = document.querySelector('#leftnavusername');
                        socket.send(JSON.stringify({
                            'message': "message",
                            "user":username2.innerHTML,
                            "receiver":receiver,
                            "receiverProfile":i,
                            "type":"canceltyping"
                        
                        }));
                    
                };
            }
        
        
            if (document.querySelector('#chat-message-submit') !== null){
                document.querySelector('#chat-message-submit').onclick = function(e) {
                    const messageInputDom = document.querySelector('#message');
                    if(messageInputDom.value !== ''){
                        const username = document.querySelector('#leftnavusername');
                        const message = messageInputDom.value;
                        socket.send(JSON.stringify({
                            'message': message,
                            "user":username.innerHTML,
                            "receiver":receiver,
                            "receiverProfile":i.username,
                            "time":formattedDate,
                            "type":"instantmessage"
            
                        }));
                        messageInputDom.value = '';
                    };

                    console.log('rannnn1')
                    
            
                } 
            
            let profilemessageInputDom = document.querySelector('#profilemessage');
            if(profilemessageInputDom !== null){
                profilemessageInputDom.focus();
                profilemessageInputDom.onkeyup = function(e) {
                    if (e.key === 'Enter') {  // enter, return
                        if(profilemessageInputDom.value !== '') {
                            document.querySelector('#profilechat-message-submit').click();
                        }
                    }
                }
            }
            
            if(document.querySelector('#profilechat-message-submit') !== null){    
                document.querySelector('#profilechat-message-submit').onclick = function(e) {
                    const message = profilemessageInputDom.value;
                    if(message !== ''){
                        let sender2 = profile_message.getAttribute("sender")
                        let receiver2 = profile_message.getAttribute("receiver")
                        socket.send(JSON.stringify({
                            'message': message,
                            "user":sender2,
                            "receiver":receiver2,
                            "receiverProfile":receiver2,
                            "time":formattedDate,
                            "type":"instantmessage"
                        }));
                        profilemessageInputDom.value = '';
                    }
                };
            }
            }                                     
            
            
            if(profile_message){
                profile_message.onclick= function(e, s, r){               
                    let sender = profile_message.getAttribute("sender")
                    let receiver = profile_message.getAttribute("receiver")           
                    let profile_message_input = document.querySelector('#profile_message_input');
                    profile_message_input.style.display="block"   
                    let focus = document.querySelector('#profilemessage')
                    focus.focus()
                    chatting(e,sender, receiver )
                }
            
            }
        }

        let profilemessagecancel = document.querySelector('#profilemessagecancel')
        if(profilemessagecancel){
        profilemessagecancel.style.marginRight="6%"   
        profilemessagecancel.style.cursor="pointer"   
        profilemessagecancel.onclick= function(){
            let profile_message_input = document.querySelector('#profile_message_input');
            profile_message_input.style.display="none"   

        }
        }
        
        function onlinecircle(onlinesignal, receiver2, parent){
        let container=document.createElement("div")
        let usernameMessage=document.createElement("div")
        let username=document.createElement("p")
        let messages=document.createElement("p")
        messages.setAttribute("id", "messagebody")
        let image=document.createElement("img")
        image.setAttribute("id", `${receiver2}`)
        username.style.opacity="0.9"
        image.style.height="50px"
        image.style.width="50px"
        image.style.borderRadius="50%"
        container.style.position="relative"
        container.classList.add(`biggerCircle-${receiver2}`)
        container.style.width="fit-content"
        parent.style.cursor="pointer"
        parent.style.height="fit-content"
        parent.style.width="fit-content"
        parent.style.width="100%"
        parent.style.display="flex"
        parent.style.marginTop="1rem"
        parent.style.gap="20px"
        parent.style.alignItems="center"
        if (onlinesignal.includes(receiver2)) {
            let circle = document.createElement("div");
            let biggerCircle = document.createElement("div");
            let onlinecircleContainer = document.createElement("div");
            
            circle.style.width = "10px";
            circle.style.height = "10px";
            circle.style.borderRadius = "50%";
            circle.style.backgroundColor = "lime";
            
            biggerCircle.classList.add(`container-${receiver2}`);
            biggerCircle.style.width = "15px";
            biggerCircle.style.height = "15px";
            biggerCircle.style.borderRadius = "50%";
            biggerCircle.style.backgroundColor = "black";
            biggerCircle.style.display = "flex";
            biggerCircle.style.justifyContent = "center";
            biggerCircle.style.alignItems = "center";
            
            onlinecircleContainer.style.position = "absolute";
            onlinecircleContainer.style.right = "-6%";
            onlinecircleContainer.style.top = "50%";
            onlinecircleContainer.style.transform = "translate(50%, -50%)"; // Center the container horizontally and vertically
            
            biggerCircle.appendChild(circle); // Append the lime circle inside the white circle
            onlinecircleContainer.appendChild(biggerCircle); // Append the white circle inside the onlinecircleContainer
            
            container.appendChild(onlinecircleContainer);
            }
            
            
        username.innerHTML=receiver2
        messages.innerHTML=i.message
        typingStore= i.message
        image.src =i.pics
        container.append(image)
        parent.append(container)
        usernameMessage.append(username)
        usernameMessage.append(messages)
        parent.append(container)
        parent.append(usernameMessage)
        parent.onmouseover= function(){
            parent.style.opacity="0.4"
        }
        parent.onmouseout= function(){
            parent.style.opacity="1"
        }
        
                                            
        }
        
        // fetcing initial chats with others
        function fetchData(onlinesignal){
            let baseresponse;
            if(chatChat){
                chatChat.innerHTML=""
            }
            let xhrchat = new XMLHttpRequest();
            xhrchat.open('GET',  `${processenv}/selfmessages/`, true);
            xhrchat.setRequestHeader('Content-Type', 'application/json');
            xhrchat.onreadystatechange = function () {
                if (xhrchat.readyState === XMLHttpRequest.DONE && xhrchat.status === 200) {   
                    try{
                        baseresponse= JSON.parse(xhrchat.responseText)
                    }catch{
                        baseresponse= Jxhr.responseText
        
                    } 
                    for(i of baseresponse.messages){
                        let receiver2;
                        const baseUserId2=document.querySelector("#baseuserid").innerHTML
                        if(i.username===baseUserId2){
                            receiver2=i.sender
                        }else{
                            receiver2=i.username
                        } 
                        let parent=document.createElement("div")
                        
                        onlinecircle(onlinesignal, receiver2, parent)
        
                        if(chatChat){
                            chatChat.append(parent)
                        }
        
                        // private mesaage with a friend from initial chat
                        parent.onclick= (e)=>{
                            messageStore.innerHTML=""; 
                            console.log('parent1')
                            console.log(receiver2)
                            initialPersonalChat(receiver2)
                            chatting(e, baseUserId2, receiver2)}
                        
                    }
                            
                }
            }
            xhrchat.send()
        }
        
        
        onlineSocket.onmessage = function(e){
        let data = JSON.parse(e.data)
        if(data.type==="send_like_message"){
            increase++
            if(bellicon !== null){
                document.querySelector("#bellicon").innerHTML=increase
            }
            ;
            if(bellicon2 !== null){
                bellicon2.innerHTML=increase
                bellicon2.style.display="flex"
            }
            document.querySelector("#bellicon").style.display="flex"
            let notif= localStorage.getItem("notificationadd")
            if(notif===null){
                let notificationCount=0
                notificationCount++;
                localStorage.setItem("notificationadd", notificationCount)
            }else{
                notif= +notif + 1
                localStorage.setItem("notificationadd",  notif)
            }
        }
        
        if(data.type==="send_add_message"){
            let increase= document.querySelector("#bellicon").innerHTML                
            increase++
            document.querySelector("#bellicon").innerHTML=increase
            bellicon2.innerHTML=increase
            document.querySelector("#bellicon").style.display="flex"
            let notif= localStorage.getItem("notificationadd")
            if(notif===null){
                let notificationCount=0
                notificationCount++;
                localStorage.setItem("notificationadd", notificationCount)
            }else{
                notif= +notif + 1
                localStorage.setItem("notificationadd",  notif)
            }
        }
        
        function onlinepeopleFn(e, receiver, pics){
            const baseUserId=document.querySelector("#baseuserid").innerHTML
            let parent=document.createElement("div")
            let container=document.createElement("div")
            let username=document.createElement("p")
            username.classList.add("onlineusernames")
            username.innerHTML=receiver
            let image=document.createElement("img")
            image.src =pics
            // username.style.color="white"
            username.style.opacity="0.9"
            image.style.height="50px"
            image.style.width="50px"
            image.style.borderRadius="50%"
            container.style.position="relative"
            let circle=document.createElement("div")
            circle.style.width="10px"
            circle.style.height="10px"
            circle.style.borderRadius="50%"
            circle.style.backgroundColor="lime"
            let biggerCircle=document.createElement("div")
            biggerCircle.style.width="15px"
            biggerCircle.style.height="15px"
            biggerCircle.style.borderRadius="50%"
            biggerCircle.style.backgroundColor="white"
            biggerCircle.style.position="absolute"
            biggerCircle.style.right="-6%"
            biggerCircle.style.top="50%"
            biggerCircle.style.display="flex"
            biggerCircle.style.justifyContent="center"
            biggerCircle.style.alignItems="center"
            biggerCircle.append(circle)
            container.append(biggerCircle) 
            parent.style.cursor="pointer"
            parent.style.height="fit-content"
            parent.style.width="100%"
            parent.style.display="flex"
            parent.style.gap="18px"
            parent.style.alignItems="center" 
                                    
            container.append(image)
            parent.append(container)
            parent.append(username)
            onlinePeople.append(parent)
            parent.onmouseover= function(){
                parent.style.opacity="0.4"
            }
            parent.onmouseout= function(){
                parent.style.opacity="1"
            }
            // online channels connection calling the chatting function
            parent.onclick= function(e){ 
                messageStore.innerHTML=""  
                initialPersonalChat(receiver)                                           
                chatting(e, baseUserId,receiver)
            }
        
        }
        
        
        if(onlinePeople){
            if(data.type === 'online'){
                onlinePeople.innerHTML=""
                for(i of data.message){
                    if(data.friends.includes(i.username)){       
                        const receiver= i.username
                        let pics= i.pics
                        onlinepeopleFn(e ,receiver, pics)
                    }
                }   
            }
        }
        
        
        // let chatlogoutUsername2= document.querySelector(`.container-${data.sender}`)
        // ;
        if(data.type==="send_logout" ){
            let allOnlineUsername= document.querySelectorAll(".onlineusernames")
            let chatlogoutUsername= document.querySelector(`.container-${data.sender}`)
            chatlogoutUsername.style.display = "none"
            for(i of allOnlineUsername){
                if(i.innerHTML === data.sender){
                    let keeper = i.parentElement
                    let iParent= i.parentElement.parentElement
                    iParent.removeChild(keeper)
                }
            }
        }
        
        if(onlinePeople){
            if(data.type==="send_online" ){
                onlinePeople.innerHTML=""
                const receiver= data.name
                let pics = data.pics
                // const baseUserId=document.querySelector("#baseuserid").innerHTML
                // let image=document.querySelector(`#${receiver}`)
                let container2=document.querySelector(`.biggerCircle-${receiver}`)
                let maincontainer=document.querySelector(`.container-${receiver}`)
        
                if(maincontainer === null){
                    let circle=document.createElement("div")
                    circle.style.width="10px"
                    let biggerCircle=document.createElement("div")
                    circle.style.height="10px"
                    circle.style.borderRadius="50%"
                    circle.style.backgroundColor="lime"
                    biggerCircle.style.width="15px"
                    biggerCircle.style.height="15px"
                    biggerCircle.style.borderRadius="50%"
                    biggerCircle.style.backgroundColor="black"
                    biggerCircle.style.position="absolute"
                    biggerCircle.style.right="-6%"
                    biggerCircle.style.top="50%"
                    biggerCircle.style.display="flex"
                    biggerCircle.style.justifyContent="center"
                    biggerCircle.style.alignItems="center"
                    biggerCircle.append(circle)
                    biggerCircle.classList.add(`container-${receiver}`)
        
                    container2.append(biggerCircle)
                }else{
                    maincontainer.style.display = "flex"
                }
                onlinepeopleFn(e ,receiver, pics)
                
            }
            
        }
        }
        
        
        logout.onclick= async()=>{
        const offlineNotification =localStorage.getItem("notificationadd")
        const offlinemessageNotification =localStorage.getItem("count")
        let formData= new FormData()
        if(offlinemessageNotification !== null || offlinemessageNotification !== undefined){
            formData.append("offlinemessageNotification", offlinemessageNotification)
        }
        formData.append("offlineNotification", offlineNotification)
        const notifResponse = await fetch(`${processenv}/logout/`, {
            method: 'POST',
            body: formData,
            headers: {
                'X-CSRFToken': csrfToken2,
            },
        });
        if(notifResponse.ok){
            window.localStorage.clear()
            window.location.href= `${processenv}/login`
            onlineSocket.send(JSON.stringify({
                'message': `${samePerson} just liked your photo`,
                "receiver":samePerson,
                "type": "loggedout",
                "sender": samePerson
            }))
        }
        
        }
        const logout2 = document.querySelector("#logout2")
        if(logout2 !== null){
        logout2.onclick= async()=>{
            const offlineNotification =localStorage.getItem("notificationadd")
            const offlinemessageNotification =localStorage.getItem("count")
            let formData= new FormData()
            ;
            ;
            if(offlinemessageNotification !== null || offlinemessageNotification !== undefined){
                formData.append("offlinemessageNotification", offlinemessageNotification)
            }
            formData.append("offlineNotification", offlineNotification)
            const notifResponse = await fetch(`${processenv}/logout/`, {
                method: 'POST',
                body: formData,
                headers: {
                    'X-CSRFToken': csrfToken2,
                },
            });
            if(notifResponse.ok){
                window.localStorage.clear()
                ;
                window.location.href= `${processenv}/login`
                onlineSocket.send(JSON.stringify({
                    'message': `${samePerson} just liked your photo`,
                    "receiver":samePerson,
                    "type": "loggedout",
                    "sender": samePerson
                }))
            }
        
        }
        }
        
        
        // function getCookie(name) {
        // let cookieValue = null;
        // if (document.cookie && document.cookie !== '') {
        //     const cookies = document.cookie.split(';');
        //     for (let i = 0; i < cookies.length; i++) {
        //         const cookie = cookies[i].trim();
        //         if (cookie.substring(0, name.length + 1) === (name + '=')) {
        //             cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
        //             break;
        //         }
        //     }
        // }
        // return cookieValue;
        // };
        
        
        // const csrftoken = getCookie('csrftoken');
        
        $("#myButton").click(function () {
        $(".dataparent").empty();
        let url = `${processenv}/findfriends/`
        
        $.ajax({
            url: url,
            type: "GET",
            dataType: "json",
            success: function (response) {
                $("#loadingsequence2").hide()
                let appendDiv= $(".dataparent")
                if(response.find_friends.length < 1){
                    let nofriend = $("<p>").text("No suggestion to fetch");
                    let appendDiv2= $(".dataparent2")
                    let containernofriend = $("<div>");
                    containernofriend.css({"width": "100%", "text-align":"center"});
        
                    containernofriend.append(nofriend);
                    // friendDiv.append(containernofriend);
                    appendDiv.hide()
                    appendDiv2.empty()
                    containernofriend.appendTo(appendDiv2);
                    appendDiv2.show()
                }else{
                    response.find_friends.forEach(function (friend) {
                        let savedMode = localStorage.getItem('mode');
                        if(friend.username){    
                            let friendDiv = $("<div>");
                            friendDiv.attr("id", "findfrienddivbg");
                            let container = $("<div>");
                            let friendDivBg;
                            if (savedMode) {
                                if(savedMode==="light"){
                                    friendDivBg= false;
                                }else{
                                    friendDivBg= true
                                }
                            }
                            // Apply the Tailwind CSS classes to the friendDiv
                            friendDiv.css({
                            "width": "100%",
                            "height": "80%",
                            "padding": "1rem",
                            "display":"flex",
                            "gap":"5px",
                            "justify-content":"center",
                            "align-content":"center",
                            "background-color":`${friendDivBg?"#1D2833":"white"} `,
                            "box-shadow": "0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04)",
                            "border-radius": "10px",
                            "margin-top": "1rem",
                            "margin-bottom": "1rem",
                            "margin-left": "1rem",
                            "margin-right": "1rem",
                            "transform-origin": "center",
                            "transition-property": "transform",
                            "transition-duration": "300ms"
                            });
                
                            // Apply additional hover styles
                            friendDiv.hover(function () {
                                $(this).css({
                                    "box-shadow": "var(--box-shadow-xl)",
                                    "transform": "scale(1.05)"
                                });
                                }, function () {
                                $(this).css({
                                    "box-shadow": "var(--box-shadow-lg)",
                                    "transform": "scale(1)"
                                });
                            });                           
                            
                            // Append the elements to the friendDiv                        
                            if(response.sent.includes(friend.username) || response.received.includes(friend.username)){
                                
                            }
                            else{       
                                appendDiv.show()
                                $(".dataparent2").hide()
                                let addFriend = $("<p>").text("Add friend");
                                addFriend.css({
                                    "width":"fit",
                                    "height":"fit",
                                    "padding":"6",
                                    "border-radius":"5px",
                                    "background-color":"rgb(22 163 74)",
                                    "color":"rgb(209 213 219)",
                                    "cursor":"pointer"                        
                                })
                                let usernameP = $("<p>").text(friend.username);                
                                (savedMode==="light" || savedMode===null)?usernameP.css({"font-size":"bold", "color":"limegreen"}): usernameP.css({"font-size":"bold", "color":"white"})
                                let bio = $("<p>").text(friend.bio);
                                let image = $("<img>");
                                image.attr("src", friend.pics);
                                image.attr("alt", "Profile Picture");
                                image.addClass("w-[80px] h-[80px]" ); // Set the desired width
                                image.attr("height", "60px !important");
                                image.css("border-radius", "50%")
                                container.css({"display": "grid", "gap":"5px"})
                
                                container.append(usernameP);
                                container.append(bio);
                                container.append(addFriend);
                                friendDiv.append(image);
                                friendDiv.append(container)                            
                
                                // Append the friendDiv to the dataContainer
                                friendDiv.appendTo(appendDiv);
                                const csrfAjaxToken = document.querySelector('[name="csrfmiddlewaretoken"]').value;
                
                                addFriend.click(function () {
                                    $.ajax({
                                    url: `${processenv}/addfriends/${friend.username}/`,
                                    type: "POST",
                                    dataType: "json",
                                    beforeSend: function(xhr, settings) {
                                        xhr.setRequestHeader("X-CSRFToken", csrfAjaxToken);
                                    },
                                    success: function (response) {
                                        if(response.success=="ok"){
                                            Toastify({
                                                text: "Request sent",
                                                duration: 3000,
                                                newWindow: true,
                                                gravity: "top", // `top` or `bottom`
                                                position: "right", // `left`, `center` or `right`
                                                stopOnFocus: true, // Prevents dismissing of toast on hover
                                                style: {
                                                    background: "linear-gradient(to right, #00b09b, #96c93d)",
                                                },
                                                // onClick: function(){} // Callback after click
                                                }).showToast();
                                        
                                        addFriend.text("Request sent")
                                        onlineSocket.send(JSON.stringify({
                                            'message': `${friend.username} sent you a friend request`,
                                            "receiver":friend.username,
                                            "sender": requestUser,
                                            "type":"friendrequest"
                                        }));
                                        }else{
                                            Toastify({
                                                text: "Request not sent! try again later",
                                                duration: 3000,
                                                newWindow: true,
                                                close: true,
                                                gravity: "top", // `top` or `bottom`
                                                position: "right", // `left`, `center` or `right`
                                                stopOnFocus: true, // Prevents dismissing of toast on hover
                                                style: {
                                                    background: "linear-gradient(to right, #00b09b, #96c93d)",
                                                },
                                                // onClick: function(){} // Callback after click
                                                }).showToast();
                                        
                                        }
                                    
                                    }
                                })
                                })
                                    
                            }
                        }
                    
                    
                    });
                }
            },
            error: function (error) {
                ;
            }
        });
        });
        
        
        
        
        const uploadPreview = document.getElementById('uploadPreview');
        const parentmodalpreview = document.getElementById('parentmodalpreview');
        const groupfileinputcontainer = document.querySelector('.group-file-input-container');
        const modalpreview = document.getElementById('modalpreview');
        const uploadpreviewImage = document.getElementById('uploadPreviewImage');
        const uploadsubmitButton = document.getElementById('uploadsubmitButton');
        const uploadCancelButton = document.getElementById('uploadcancelButton');
        
        function previewFn(e, uploadpreviewImage, modalpreviewCancel, uploadPreview, uploadCancelButton, uploadsubmitButton, modalpreview, groupfileinputcontainer, parentmodalpreview ){
        const reader = new FileReader();
        let selectedFile= e.target.files[0]
        let parent= e.target.parentElement.parentElement.parentElement.parentElement.parentElement.parentElement;
        if (selectedFile) {
            reader.onload = function (e) {
                uploadpreviewImage.src = e.target.result;
                uploadPreview.style.display = 'block';
                parent.style.display = 'none';
            };
            reader.readAsDataURL(selectedFile);
        }
        
        uploadCancelButton.onclick = function (e) {
            uploadpreviewImage.value = "";
            uploadPreview.style.display = 'none';
            
        }
        
        modalpreviewCancel.onclick = function (e) {
            modalpreview.value = "";
            parentmodalpreview.style.display = 'none';
            groupfileinputcontainer.style.display = 'block';                
        }
        
        uploadsubmitButton.onclick = function (e) {
            uploadPreview.style.display = 'none';
            parent.style.display = 'block';
            modalpreview.style.display = 'block';
            const selectedFileUrl = URL.createObjectURL(selectedFile)
            groupfileinputcontainer.style.display = 'flex';
            groupfileinputcontainer.style.justifyContent = 'center';
            groupfileinputcontainer.style.gap = '1rem';
            parentmodalpreview.style.display = 'block';
            modalpreview.src = selectedFileUrl;
        
        };
        
        }
        
        function previewFn2(e, uploadpreviewImage, modalpreviewCancel, uploadPreview, uploadCancelButton, uploadsubmitButton, modalpreview, groupfileinputcontainer, parentmodalpreview ){
        const reader = new FileReader();
        let selectedFile= e.target.files[0]
        let parent= e.target.parentElement.parentElement.parentElement.parentElement.parentElement;
        
        if (selectedFile) {
            reader.onload = function (e) {
                uploadpreviewImage.src = e.target.result;
                uploadPreview.style.display = 'block';
                parent.style.display = 'none';
            };
            reader.readAsDataURL(selectedFile);
        }
        
        ;
        uploadCancelButton.onclick = function (e) {
            uploadpreviewImage.value = "";
            uploadPreview.style.display = 'none';
            
        }
        
        uploadsubmitButton.onclick = function (e) {
            uploadPreview.style.display = 'none';
            parent.style.display = 'block';
            modalpreview.style.display = 'block';
            const selectedFileUrl = URL.createObjectURL(selectedFile)
            ;
            groupfileinputcontainer.style.display = 'flex';
            groupfileinputcontainer.style.justifyContent = 'center';
            groupfileinputcontainer.style.gap = '1rem';
            parentmodalpreview.style.display = 'block';
            modalpreview.src = selectedFileUrl;
        };
        
        modalpreviewCancel.onclick = function (e) {
            modalpreview.value = "";
            parentmodalpreview.style.display = 'none';
            groupfileinputcontainer.style.display = 'block';                
        }
        
        }
        
        
        $(document).ready(function(){
        let groupcreate = $('#groupcreate');            
        let groupmodal = document.querySelector('#groupmodalpost'); 
        let groupcreatesubmit = document.querySelector('#grouppostsubmit'); 
        let groupPostmodalpreviewCancel = document.getElementById('groupPost-preview-cancel');
        let groupclose = $('#groupclose'); 
        let groupcreatefileinputcontainer = document.querySelector('.groupPostfile-input-container'); 
        let groupPostparentmodalpreview = document.querySelector('#groupPostparentmodalpreview'); 
        let groupPostmodalpreview = document.querySelector('#groupPostmodalpreview'); 
        
        $('#home').click(function(){
            $('#sidebar').toggleClass('visible');
        });
        $('#sidebarCancel').click(function(){
            $('#sidebar').toggleClass('visible');
        });
        
        groupcreate.click(function(){
            groupmodal.style.display= "block"
            document.querySelector("#id_insidegroupcontent").focus()
        })
        
        groupclose.click(function(){
            groupmodal.style.display= "none"
            // groupmodal
        })
        
        if(document.querySelector("#groupcreate_id_post_file") !== null){
            document.querySelector("#groupcreate_id_post_file").addEventListener("change", (e)=>{
                previewFn(e, uploadpreviewImage, groupPostmodalpreviewCancel, uploadPreview, uploadCancelButton, uploadsubmitButton, groupPostmodalpreview, groupcreatefileinputcontainer, groupPostparentmodalpreview
                
            )})
        }
        
        let groupCreatePreviewCancel = document.querySelector("#group-preview-cancel")
        let groupCreatemodalpreview = document.querySelector("#modalpreview")
        let groupCreateparentmodalpreview = document.querySelector("#parentmodalpreview")
        let groupcreateButton = document.querySelector("#group_id_file")
        
        // creating group and not post
        groupcreateButton.addEventListener("change", (e)=>{
            ;
            previewFn(e, uploadpreviewImage, groupCreatePreviewCancel, uploadPreview, uploadCancelButton, uploadsubmitButton, groupCreatemodalpreview, groupfileinputcontainer, groupCreateparentmodalpreview)
        
        })
        
        // creating a new group
        $('#groupsubmit').on("click", function() {
            let name = $("#id_name").val();
            let description = $("#id_description").val();
            let formData = new FormData();
            formData.append("csrfmiddlewaretoken", csrfToken2);
            formData.append("name", name);
            formData.append("description", description);
            // [0].files[0]);
            if($("#group_id_file")[0]){
                formData.append("cover_photo", $("#group_id_file")[0].files[0]); // Assuming you have an input with id "comment_pics"
            }
            
            $.ajax({
                method: "POST",
                url: `${processenv}/create-group/`,
                data: formData,
                processData: false,
                contentType: false,
                success: function(response) {
                    
                    if(response.success===false){
                        Toastify({
                            text: "Group creation failed",
                            duration: 3000,
                            newWindow: true,
                            close: true,
                            gravity: "top", // `top` or `bottom`
                            position: "right", // `left`, `center` or `right`
                            stopOnFocus: true, // Prevents dismissing of toast on hover
                            style: {
                                background: "linear-gradient(to right, #00b09b, #96c93d)",
                            },
                            // onClick: function(){} // Callback after click
                            }).showToast();
                    }else{
                        window.location.reload()
                        Toastify({
                            text: "Group creation successfull",
                            duration: 3000,
                            newWindow: true,
                            gravity: "top", // `top` or `bottom`
                            position: "right", // `left`, `center` or `right`
                            stopOnFocus: true, // Prevents dismissing of toast on hover
                            style: {
                                background: "linear-gradient(to right, #00b09b, #96c93d)",
                            },
                            // onClick: function(){} // Callback after click
                            }).showToast();
                    }
                    // Handle the response here
                    ;
                },
                error: function(error) {
                    ;
                    // Handle the error here
                }
            });
        });
        
        
        if(groupPostmodalpreviewCancel !== null){
            groupPostmodalpreviewCancel.onclick = function (e) {
                groupPostmodalpreview.value = "";
                groupPostparentmodalpreview.style.display = 'none';
                groupfileinputcontainer.style.display = 'block';                
            }
        }
        if(groupcreatesubmit !== null){
            groupcreatesubmit.addEventListener('click', async (e) => {
                e.preventDefault();
                let fileInput = document.querySelector("#groupcreate_id_post_file")
                let fileText = document.querySelector("#id_insidegroupcontent").value
                const formData = new FormData();
                if(fileText !== null){
                    formData.append("text", fileText)
                }
                if(fileInput.files.length>0){
                    formData.append('file', fileInput.files[0])
                }
                const response = await fetch(`${baseresponseUrlKey}/post-on-group/${groupname}/`, {
                    method: 'POST',
                    body: formData,
                    headers: {
                        'X-CSRFToken': csrfToken2,
                    },
                });
        
                if (response.ok) {
                    groupmodal.style.display="none"
                    if(response.status === 201){
                        Toastify({
                            text: "Post successfull ",
                            duration: 3000,
                            newWindow: true,
                            gravity: "top", // `top` or `bottom`
                            position: "right", // `left`, `center` or `right`
                            stopOnFocus: true, // Prevents dismissing of toast on hover
                            style: {
                                background: "linear-gradient(to right, #00b09b, #96c93d)",
                            },
                            // onClick: function(){} // Callback after click
                            }).showToast();
        
                        window.location.reload()
                    }
                    else{
                        Toastify({
                            text: "Post successfull, waiting for approval ",
                            duration: 3000,
                            newWindow: true,
                            gravity: "top", // `top` or `bottom`
                            position: "right", // `left`, `center` or `right`
                            stopOnFocus: true, // Prevents dismissing of toast on hover
                            style: {
                                background: "linear-gradient(to right, #00b09b, #96c93d)",
                            },
                            // onClick: function(){} // Callback after click
                        }).showToast();
                        }
                    document.querySelector('#id_insidegroupcontent').value = ""
                    document.querySelector('#groupcreate_id_post_file').value = ""
                    
                } else {
                    Toastify({
                        text: "Post unsuccessfull, please try again later ",
                        duration: 3000,
                        newWindow: true,
                        close: true,
                        gravity: "top", // `top` or `bottom`
                        position: "right", // `left`, `center` or `right`
                        stopOnFocus: true, // Prevents dismissing of toast on hover
                        style: {
                            background: "linear-gradient(to right, #00b09b, #96c93d)",
                        },
                        // onClick: function(){} // Callback after click
                        }).showToast();
                    // Handle error, maybe show an error message
                }
            })
        }
        
        });        
        
        $(document).ready(function () {
        let likeCount = $(".likeholder"); 
        let c = '{{csrf_token}}'  
        $.ajaxSetup({
            headers: {
                "X-CSRFToken": csrfToken2,
            },
        });
        
        $(".like-button").on("click", function () {
            let postId = $(this).data("post-id");
            let clickedButton = $(this);
                $.ajax({
                    url: `${processenv}/like_post/`,  // Replace 'like_post' with your actual URL name for liking a post
                    method: "POST",
                    data: { post_id: postId },
                    dataType: "json",
                    success: function (data) {
                        if(data.like_count >1){
                            likeCount.text(data.like_count);
                        }
                        if (data.status==="like") {
                            clickedButton.css("color","rgb(220, 38, 38)")
                            onlineSocket.send(JSON.stringify({
                                    'message': `${samePerson} just liked your photo`,
                                    "receiver":data.receiver,
                                    "postId": postId,
                                    "sender": samePerson,
                                    "type": "likepost"
                            }));
                        } else {
                            const mode = localStorage.getItem('mode');
                            if(mode==="light"){
                                clickedButton.css("color","#0d2438")                                
                            }else{
                                clickedButton.css("color","white")
        
                            }
                    
                        }
                    },
                    error: function () {
                        alert("Error occurred while processing your request.");
                    },
                });           
        });
        
        $(".group-like-button").on("click", function () {
            let postId = $(this).data("post-id");
            let clickedButton = $(this);
                $.ajax({
                    url: `${processenv}/group_like_post/`,  // Replace 'like_post' with your actual URL name for liking a post
                    method: "POST",
                    data: { post_id: postId },
                    dataType: "json",
                    success: function (data) {
                        if(data.like_count >1){
                            likeCount.text(data.like_count);
                        }
                        if (data.status==="like") {
                            clickedButton.css("color","rgb(220, 38, 38)")
                        } else {
                            const mode = localStorage.getItem('mode');
                            if(mode==="light"){
                                clickedButton.css("color","#0d2438")                                
                            }else{
                                clickedButton.css("color","white")
        
                            }                       
                        }
                    },
                    error: function () {
                        alert("Error occurred while processing your request.");
                    },
                });           
        });
            
        });
        
        
        // increasing message count 
        const leftnav= document.querySelector("#leftnavmessage")
        // const topmessageNav= document.querySelector("#topmessagenav")
        const baserooms= document.querySelector("#baseuserid").innerHTML
        
        
        // intitial user channels connection
        const initialprotocol = window.location.protocol === 'https:' ? 'wss:' : 'ws:';
        const srcs = `${initialprotocol}//${window.location.host}/ws/chat/${baserooms}/ `
        const messagesocket = new WebSocket(srcs)
        
        
        messagesocket.onmessage = function(e){
        let data = JSON.parse(e.data)
        
        
        if(data.type==="initialmessage"){
            if(window.location.pathname==="/messages/"){
                fetchData(data.online)
            }
            
        }
        
        if(data.type==="chat_message"){
            let onlinesignal = data.online
            fetchData(onlinesignal)
            ;
            if(window.location.pathname==="/messages/"){
                localStorage.removeItem("count")
            }else{               
                if(data.message !== ""){
                    count++
                    localStorage.setItem("count", count)
                }
                if( count >= 1 ){
                    let messagenotif= document.querySelector("#messagenotif")
                    let messagenotif2= document.querySelector("#messagenotif2")
                    if(messagenotif !== null){
                        messagenotif.innerHTML=count
                        messagenotif.style.display="flex"
                        messagenotif.style.color="white"
                        messagenotif.style.justifyContent="center"
                        messagenotif.style.alignItems="center"
                    }
                    if(messagenotif2 !== null){
                        messagenotif2.innerHTML=count
                        messagenotif2.style.color="white"
                        messagenotif2.style.display="flex"
                        messagenotif2.style.justifyContent="center"
                        messagenotif2.style.alignItems="center"
                    }
                }
            }
        }
        
        
            if(data.type==="typing"){
                let typing=document.querySelector('#messagebody')
                if(typing !== null){
                    typing.innerHTML= "Typing..."
                    typing.style.color= "green"
                }
            }
            if(data.type==="canceltyping"){
                let typing=document.querySelector('#messagebody')
                if(typing !== null){
                    typing.innerHTML= typingStore
                    typing.style.color= "#0D2438"
                }
            }
        
        }
            
        if(leftnav){
        leftnav.onclick=()=>{
            localStorage.removeItem("count")
            fetchData()
        }
        }
        console.log('fired1')
        })
    document.addEventListener("DOMContentLoaded", function(){
        const modal = document.querySelector('#modal');   
        const submitButton = document.querySelector('#submit');
        const statuSubmitButton = document.querySelector('#statussubmit');
        const statusmodal = document.querySelector('#statusmodal');
        const statusShow = document.querySelector('#status');
        
        // Get the button to close the modal
        const closeButton = document.querySelector('#button');
        const statusCloseButton = document.querySelector('#statusbutton');
        const fileInput = document.querySelector('#id_filepost');
        const fileInputStatus = document.querySelector('#id_filestatus');
        
        const postparentmodalpreview = document.getElementById('postparentmodalpreview');
        const postfileinputcontainer = document.querySelector('.file-input-container');
        const postmodalpreview = document.getElementById('postmodalpreview');
        const postmodalpreviewCancel = document.getElementById('post-preview-cancel');
        
        
        
        const statusparentmodalpreview = document.getElementById('statusparentmodalpreview');
        const statusfileinputcontainer = document.querySelector('.status-file-input-container');
        const statusmodalpreview = document.getElementById('statusmodalpreview');
        const statusmodalpreviewCancel = document.getElementById('status-preview-cancel');
        
        
        
        
        
        // Add event listener to the close button 
        closeButton.addEventListener('click', ()=>{modal.style.display='none'});
        statusCloseButton.addEventListener('click', ()=>{statusmodal.style.display='none'});
        
        fileInput.addEventListener("change", (e)=>previewFn2(e, uploadpreviewImage, postmodalpreviewCancel, uploadPreview, uploadCancelButton, uploadsubmitButton, postmodalpreview, postfileinputcontainer, postparentmodalpreview ))
        
        
        // post create
        submitButton.addEventListener('click', async (e) => {
        e.preventDefault();
        const formData = new FormData(document.querySelector('#postform'));
        if(fileInput.files.length>0){
            formData.append('file', fileInput.files[0])
        }
        const response = await fetch(`${processenv}/create_post/`, {
            method: 'POST',
            body: formData,
            headers: {
                'X-CSRFToken': '{{ csrf_token }}',
            },
        });
        
        if (response.ok) {
            Toastify({
                text: "Post successfull",
                duration: 3000,
                newWindow: true,
                gravity: "top", // `top` or `bottom`
                position: "right", // `left`, `center` or `right`
                stopOnFocus: true, // Prevents dismissing of toast on hover
                style: {
                    background: "linear-gradient(to right, #00b09b, #96c93d)",
                },
                // onClick: function(){} // Callback after click
                }).showToast();
            window.location.reload()
        } else {
            Toastify({
                text: "Post unsuccessfull, please try again later ",
                duration: 3000,
                newWindow: true,
                close: true,
                gravity: "top", // `top` or `bottom`
                position: "right", // `left`, `center` or `right`
                stopOnFocus: true, // Prevents dismissing of toast on hover
                style: {
                    background: "linear-gradient(to right, #00b09b, #96c93d)",
                },
                // onClick: function(){} // Callback after click
                }).showToast();
            // Handle error, maybe show an error message
        }
        });
        
        
        if(statusShow){
            statusShow.addEventListener("click", function(){
            let mobilecreatepost = document.querySelector('#mobile');
            let topmessagenav = document.querySelector('#topmessagenav');
            console.log(topmessagenav);
            console.log('leftnavusername');
            console.log(mobilecreatepost)
            statusmodal.style.display='block'
            document.querySelector('#status_content').focus();
        
        })
        } 
        
        fileInputStatus.addEventListener("change", (e)=>previewFn2(e, uploadpreviewImage, statusmodalpreviewCancel, uploadPreview, uploadCancelButton, uploadsubmitButton, statusmodalpreview, statusfileinputcontainer, statusparentmodalpreview ))
        
        
        if(statuSubmitButton){
        // status create
        statuSubmitButton.addEventListener('click', async (e) => {
            e.preventDefault();
            const formDatastatus = new FormData(document.querySelector('#statusform'));            
            if(fileInputStatus.files.length>0){
                formDatastatus.append('file', fileInputStatus.files[0])
            }
            const response = await fetch(`${processenv}/create_status/`, {
                method: 'POST',
                body: formDatastatus,
                headers: {
                    'X-CSRFToken': '{{ csrf_token }}',
                },
            });
        
            
            if (response.ok) {
                // Handle success, maybe close the modal and show a success message
                window.location.reload()
                Toastify({
                    text: "Status created",
                    duration: 3000,
                    newWindow: true,
                    gravity: "top", // `top` or `bottom`
                    position: "right", // `left`, `center` or `right`
                    stopOnFocus: true, // Prevents dismissing of toast on hover
                    style: {
                        background: "linear-gradient(to right, #00b09b, #96c93d)",
                    },
                    // onClick: function(){} // Callback after click
                }).showToast();
                                    
                // Reload or update the posts on the page as needed
            } else {
                Toastify({
                    text: "An error occured! try again later",
                    duration: 3000,
                    newWindow: true,
                    close: true,
                    gravity: "top", // `top` or `bottom`
                    position: "right", // `left`, `center` or `right`
                    stopOnFocus: true, // Prevents dismissing of toast on hover
                    style: {
                        background: "linear-gradient(to right, #00b09b, #96c93d)",
                    },
                    // onClick: function(){} // Callback after click
                }).showToast();
                                    
                statusmodal.style.display = 'none';
                // Handle error, maybe show an error message
            }
        });
        }
        

    })
        window.addEventListener('load', function() {
        document.querySelector("#loadingmodal").style.display="none"
        });
        
   
   
        </script> -->
        <!-- <script src="{% static 'usedJsCode/base.js' %}"></script> -->
    </div>

</body>
</html>
